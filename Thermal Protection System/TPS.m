%% TPS as function of flight path angle
%  Written by Daria Stifel

%% Constants
k    = 1.9027*10^-4;  % Sutton-Graves constant for Mars
rn   = 0.6625;        % effective nose radius [m]
p0   = 0.15;          % "sea-level" atm. density [kg/m^3]
Vatm = 5.94312*10^3;     % atm. entry velocity [m/s]
B    = 33.8;          % ballistic coefficient [kg/m^2]
H    = 7.5*10^3;      % scale height [m]
me   = 700;           % entry mass [kg] 
y    = 13.01119610;   % flight path angle [deg]

%% Height and Velocity Over Descent Time

p = [0.00000040366774	0.00000067077726	0.00000110562320	0.00000180669270	0.00000292543910	0.00000728188720	0.00001739598200	0.00003959820400	0.00008482721300	0.00016853754000	0.00030234480000	0.00048278594000	0.00069538657000	0.00082101395000	0.00095073975000	0.00108358200000	0.00121934670000	0.00135877310000	0.00150188810000	0.00164889100000	0.00180148220000	0.00194805510000	0.00210128880000	0.00226188760000	0.00243120550000	0.00243120550000	0.00240845140000	0.00238658020000	0.00236557150000	0.00234540600000	0.00232606510000	0.00230753120000	0.00228978750000	0.00227281790000	0.00225660710000	0.00224114070000	0.00222640480000	0.00221238640000	0.00219907300000	0.00218645310000	0.00217451540000	0.00216324950000	0.00215264570000	0.00214269470000	0.00213338800000	0.00212471740000	0.00211667560000	0.00210925560000	0.00210245110000	0.00209625620000	0.00209066580000	0.00208567490000	0.00208127950000	0.00207747570000	0.00207426040000	0.00207163080000	0.00206958470000	0.00206812030000	0.00206723650000	0.00206693250000	0.00206720800000	0.00206806330000	0.00206949910000	0.00207151650000	0.00207411740000	0.00207730390000	0.00208107870000	0.00208544490000	0.00209040640000	0.00209596720000	0.00210213220000	0.00210890670000	0.00211629620000	0.00212430730000	0.00213294680000	0.00214222210000	0.00215214120000	0.00216271270000	0.00217394580000	0.00218585020000	0.00219843640000	0.00221171540000	0.00222569880000	0.00224039910000	0.00225582930000	0.00227200310000	0.00228434520000	0.00230923150000	0.00232177640000	0.00233438970000	0.00234707160000	0.00235982270000	0.00237264320000	0.00238553360000	0.00239849420000	0.00241152540000	0.00242462760000	0.00243780120000	0.00245104660000	0.00246436420000	0.00247775430000	0.00249121740000	0.00250475380000	0.00251836400000...
    0.00253204830000	0.00254580730000	0.00255964110000	0.00257355040000	0.00258753550000	0.00260159680000	0.00261573470000	0.00262994960000	0.00264424200000	0.00265861230000	0.00267306090000	0.00268758830000	0.00270219480000	0.00271688100000	0.00273164710000	0.00274649380000	0.00276142140000	0.00277643030000	0.00279152100000	0.00280669400000	0.00282194970000	0.00283728850000	0.00285271090000	0.00286821740000	0.00288380840000	0.00289948440000	0.00291524590000	0.00293109320000	0.00294702700000	0.00296304760000	0.00297915550000	0.00299535120000	0.00301163530000	0.00302800810000	0.00304447010000	0.00306102190000	0.00307766390000	0.00309439670000	0.00311122070000	0.00312813640000	0.00314514430000	0.00316224490000	0.00317943880000	0.00319672640000	0.00321410830000	0.00323158490000	0.00324915690000	0.00326682460000	0.00328458870000	0.00330244960000	0.00332040790000	0.00333846420000	0.00335661890000	0.00337487260000	0.00339322580000	0.00341167910000	0.00343023300000	0.00344888810000	0.00346764500000	0.00348650410000	0.00350546610000	0.00352453140000	0.00354370080000	0.00356297470000	0.00358235370000	0.00360183830000	0.00362142930000	0.00364112710000	0.00366093230000	0.00368084550000	0.00370086740000	0.00372099840000	0.00374123930000	0.00376159050000	0.00378205270000	0.00380262660000	0.00382331260000	0.00384411150000	0.00386502390000	0.00388605030000	0.00390719140000	0.00392844790000	0.00394982020000	0.00397130920000	0.00399291540000	0.00401463940000	0.00403648200000	0.00405844370000	0.00408052520000	0.00410272720000	0.00412505030000	0.00414749520000	0.00417006250000	0.00419275300000	0.00421556720000	0.00423850600000	0.00426156980000	0.00428475950000	0.00430807570000	0.00433151920000	0.00435509050000	0.00437879050000	0.00440261970000	0.00442657900000...
    0.00445066900000	0.00447489050000	0.00449924410000	0.00452373070000	0.00454835080000    0.00457310530000	0.00459799480000	0.00462302020000	0.00464818210000	0.00467348140000	0.00469891870000	0.00472449480000	0.00475021050000	0.00477606650000	0.00480206370000	0.00482820270000	0.00485448440000	0.00488090950000	0.00490747880000	0.00493419310000	0.00496105330000	0.00498806000000	0.00501521410000	0.00504251650000	0.00506996780000	0.00509756900000	0.00512532080000	0.00515322410000	0.00518127980000	0.00520948850000	0.00523785120000	0.00526636880000	0.00529504200000	0.00532387170000	0.00535285890000	0.00538200420000	0.00541130860000	0.00544077310000	0.00547039830000	0.00550018530000	0.00553013490000	0.00556024800000	0.00559052550000	0.00562096830000	0.00565157730000	0.00568235340000	0.00571329750000	0.00574441050000	0.00577569350000	0.00580714720000	0.00583877260000	0.00587057080000	0.00590254250000	0.00593468880000	0.00596701070000	0.00599950900000	0.00603218470000	0.00606503890000	0.00609807250000	0.00613128640000	0.00616468180000	0.00619825940000	0.00623202050000	0.00626596590000	0.00630009660000	0.00633441370000	0.00636891830000	0.00640361120000	0.00643849370000	0.00647356660000	0.00650883110000	0.00654428810000	0.00657993880000	0.00661578420000	0.00665182530000	0.00668806330000	0.00672449920000	0.00676113420000	0.00679796920000	0.00683500530000	0.00687224380000	0.00690968570000	0.00694733200000	0.00698518400000	0.00702324280000	0.00706150940000	0.00709998500000	0.00713867080000	0.00717756800000	0.00721667760000	0.00725600080000	0.00729553880000	0.00733529290000	0.00737526400000	0.00741545360000	0.00745586270000	0.00749649250000	0.00753734430000	0.00757841930000	0.00761971860000	0.00766124360000	0.00770299550000	0.00774497540000	0.00778718470000...
    0.00782962460000	0.00787229640000	0.00791520130000	0.00795834070000	0.00800171570000    0.00804532770000	0.00808917800000	0.00813326790000	0.00817759870000	0.00822217180000	0.00826698840000	0.00831204980000	0.00835735750000	0.00840291280000	0.00844871700000	0.00849477150000	0.00854107760000	0.00858763680000	0.00863445040000	0.00868151990000	0.00872884650000	0.00877643180000	0.00882427710000	0.00887238390000	0.00892075360000	0.00896938770000	0.00901828750000	0.00906745460000	0.00911689040000	0.00916659640000	0.00921657410000	0.00926682480000	0.00931735030000	0.00936815190000	0.00941923110000	0.00947058960000	0.00952222870000	0.00957415010000	0.00962635530000	0.00967884580000	0.00973162330000	0.00978468920000	0.00983804530000	0.00989169290000	0.00994563380000	0.00999986960000	0.01005440200000	0.01010923200000	0.01016436200000	0.01021979400000	0.01027552800000	0.01033156700000	0.01038791300000	0.01044456700000	0.01050153000000	0.01055880400000	0.01061639200000	0.01067429500000	0.01073251400000	0.01079105200000	0.01084990900000	0.01090908900000	0.01096859200000	0.01102842000000	0.01108857500000	0.01114905900000	0.01120987400000	0.01127102200000	0.01133250400000	0.01139432200000	0.01145647800000	0.01151897400000	0.01158181100000	0.01164499300000	0.01170851900000	0.01177239300000	0.01183661700000	0.01190119100000	0.01196611900000	0.01203140200000	0.01209704200000	0.01216304000000	0.01222940000000	0.01229612300000	0.01236321000000	0.01243066400000	0.01249848800000	0.01256668200000	0.01263524900000	0.01270419100000	0.01277351000000	0.01284320900000	0.01291328800000	0.01298375100000	0.01305459900000	0.01312583500000	0.01319746000000	0.01326947800000	0.01334188900000	0.01341469600000	0.01348790100000	0.01356150700000	0.01363551500000	0.01370992800000...
    0.01378474900000	0.01385997800000	0.01393561900000	0.01401167400000	0.01408814500000	0.01416503400000	0.01424234400000	0.01432007700000	0.01439823500000	0.01447682000000];


v = [5890	5893.065	5895.4412	5896.6808	5896.0549	5884.1049	5843.8131	5735.8671	5492.0344	5025.5205	4314.7218	3446.1509	2611.1879	2238.9923	1916.8785	1643.5403	1414.5862	1223.1805	1063.513	930.40173	818.64507	731.30225	656.32785	591.77913	535.9096	535.9096	528.03427	520.15895	512.28362	504.40829	496.53296	488.65763	480.7823	472.90697	465.03164	457.15632	449.28099	441.40566	433.53033	425.655	417.77967	409.90434	402.02901	394.15368	386.27836	378.40303	370.5277	362.65237	354.77704	346.90171	339.02638	331.15105	323.27573	315.4004	307.52507	299.64974	291.77441	283.89908	276.02375	268.14842	260.27309	252.39777	244.52244	236.64711	228.77178	220.89645	213.02112	205.14579	197.27046	189.39514	181.51981	173.64448	165.76915	157.89382	150.01849	142.14316	134.26783	126.3925	118.51718	110.64185	102.76652	94.89119	87.015861	79.140532	71.265203	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874...
    63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874...
    63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874	63.389874];



%% Dyanmic Pressure
qmax = max(0.5*p.*v.^2);

%% Heat Rate as Function of Height and Velocity
%q = k*((p./rn).^0.5).*(v.^3);

%% Peak Heat Rate & Total Integrated Heat Load

qs = (k/sqrt(rn))*((B*sind(y)/(3*H)).^0.5)*((Vatm^3)/exp(0.5));
t1 = (k*Vatm^2);
t2 = (B/p0);
t3 = pi*H;
t4 = rn*sind(y);
J  = t1*(t2*(t3./t4)).^0.5; 

%% Plots

qsCM = qs*10^-4;    % heat rate in W/cm^2
JCM  = J*10^-4;     % heat load in W/cm^2

% fig1 = figure(1);
% plot(y,qsCM,'-b')
% title('Peak Heat Rate vs. Flight Path Angle')
% fig2 = figure(2);
% plot(y,JCM,'-r');
% title('Total Heat Load vs. Flight Path Angle')
 

T = table(y',qsCM',JCM' )

%% Aeroshell Structural mass
mh = 0.02328*(qmax^0.1708)*me;
mb = 0.14*me;

%% Thickness
SA       = pi*(1+sqrt(.482^2 + 1^2));     % surface area of heat shield (based on phoenix cone) [m^2]
p_heat   = 265;                           % density PICA [kg/m^3]
t_heat   = mh/(p_heat*SA);                % thickness of heat shield [m]
t_heatcm = t_heat*10^2;                   % thickness of heat shield [cm]
%% Readout

fprintf('The heatshield mass is: %.2f kg\n', mh)
fprintf('The backshell mass is: %.2f kg\n', mb)
fprintf('The peak heat rate is: %.2f W/cm^2\n', qsCM)
fprintf('The total heat load is: %.2f J/cm^2\n', JCM)
fprintf('The thickness of the heatshield is: %.2f cm\n', t_heatcm)
